<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON TACTICS: ULTIMATE EDITION</title>
    <style>
        :root {
            --bg: #020617;
            --panel: rgba(30, 41, 59, 0.95);
            --primary: #38bdf8;
            --accent-x: #fb7185;
            --accent-o: #34d399;
            --text: #f1f5f9;
        }

        * { 
            box-sizing: border-box; margin: 0; padding: 0; 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            overflow-x: hidden;
        }

        .wrapper {
            width: 100%;
            max-width: 420px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .header-box {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            position: relative;
        }

        h1 {
            text-align: center;
            color: var(--primary);
            letter-spacing: 4px;
            font-size: 1.8rem;
            text-shadow: 0 0 15px rgba(56, 189, 248, 0.4);
            font-weight: 900;
        }

        .edit-tool {
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.6;
            transition: 0.3s;
        }
        .edit-tool:hover { opacity: 1; transform: scale(1.1); }

        .status-bar {
            background: rgba(255,255,255,0.05);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 800;
            color: var(--primary);
            text-transform: uppercase;
            border: 1px solid rgba(255,255,255,0.1);
            min-height: 45px;
        }

        .settings-container {
            background: var(--panel);
            border-radius: 20px;
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .settings-container.hidden { display: none; }
        .row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
        .row-label { font-size: 0.7rem; color: #94a3b8; font-weight: 900; text-transform: uppercase; width: 75px; }
        .group { display: flex; flex: 1; background: rgba(0,0,0,0.3); padding: 4px; border-radius: 10px; overflow: hidden; }
        .opt-btn {
            flex: 1; padding: 10px 0; border: none; background: transparent;
            color: #64748b; font-weight: bold; cursor: pointer; border-radius: 7px;
            font-size: 0.7rem; transition: 0.2s;
        }
        .opt-btn.active { background: var(--primary); color: #020617; }

        .board-frame {
            width: 100%;
            aspect-ratio: 1 / 1;
            display: flex; align-items: center; justify-content: center;
        }

        .board-grid {
            display: grid;
            width: 100%;
            height: 100%;
            gap: 6px;
            grid-template-columns: repeat(var(--cols, 3), 1fr);
        }

        .cell {
            background: #0f172a;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; aspect-ratio: 1 / 1;
            border: 1px solid rgba(255,255,255,0.05);
            transition: 0.15s;
        }

        .cell span { font-size: var(--fs, 3rem); font-weight: 900; }
        .cell.x span { color: var(--accent-x); text-shadow: 0 0 15px var(--accent-x); }
        .cell.o span { color: var(--accent-o); text-shadow: 0 0 15px var(--accent-o); }
        .cell.winner { background: var(--primary); box-shadow: 0 0 20px var(--primary); }
        .cell.winner span { color: #020617; }
        .cell.hint { background: rgba(251, 191, 36, 0.2); border: 2px solid #fbbf24; }

        .footer-btns { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .btn {
            padding: 15px 5px; border: none; border-radius: 14px;
            font-weight: 900; cursor: pointer; text-transform: uppercase;
            font-size: 0.7rem; transition: 0.2s;
        }
        .btn-play { background: var(--primary); color: #020617; }
        .btn-side { background: #334155; color: white; }
        .btn-hint { background: #475569; color: #fbbf24; }
        .btn-undo { background: #1e293b; color: #94a3b8; border: 1px solid rgba(255,255,255,0.1); }
        .locked { pointer-events: none; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="header-box">
        <h1>NEON TACTICS</h1>
        <div class="edit-tool" onclick="customSettings()">‚úèÔ∏è</div>
    </div>

    <div class="status-bar" id="status">–ì–û–¢–û–í –ö –¢–†–£–î–£</div>

    <div class="settings-container" id="menu">
        <div class="row">
            <span class="row-label">–ü–û–õ–ï</span>
            <div class="group">
                <button class="opt-btn active" onclick="config('size', 3, this)">3x3</button>
                <button class="opt-btn" onclick="config('size', 4, this)">4x4</button>
                <button class="opt-btn" onclick="config('size', 5, this)">5x5</button>
            </div>
        </div>
        <div class="row">
            <span class="row-label">–ú–û–ó–ì–ò</span>
            <div class="group">
                <button class="opt-btn" onclick="config('diff', 'easy', this)">–ò–ó–ò</button>
                <button class="opt-btn active" onclick="config('diff', 'god', this)">–ë–û–ì</button>
            </div>
        </div>
        <div class="row">
            <span class="row-label">–¢–ê–ö–¢–ò–ö–ê</span>
            <div class="group">
                <button class="opt-btn active" onclick="config('tactic', 'auto', this)">AUTO</button>
                <button class="opt-btn" onclick="config('tactic', 'center', this)">–¶–ï–ù–¢–†</button>
                <button class="opt-btn" onclick="config('tactic', 'corners', this)">–£–ì–õ–´</button>
                <button class="opt-btn" onclick="config('tactic', 'side', this)">–ë–û–ö–ê</button>
            </div>
        </div>
        <div class="row">
            <span class="row-label">–Ø –ó–ê</span>
            <div class="group">
                <button class="opt-btn active" onclick="config('playerSide', 'X', this)">X</button>
                <button class="opt-btn" onclick="config('playerSide', 'O', this)">O</button>
            </div>
        </div>
        <div class="row">
            <span class="row-label">–•–û–î–ò–¢</span>
            <div class="group">
                <button class="opt-btn active" onclick="config('start', 'p', this)">–Ø</button>
                <button class="opt-btn" onclick="config('start', 'b', this)">–ë–û–¢</button>
            </div>
        </div>
    </div>

    <div class="board-frame">
        <div class="board-grid" id="board"></div>
    </div>

    <div class="footer-btns">
        <button class="btn btn-side" onclick="toggleMenu()">‚öôÔ∏è</button>
        <button class="btn btn-hint" onclick="getHint()">üí°</button>
        <button class="btn btn-undo" onclick="undoMove()">‚Ü©Ô∏è</button>
        <button class="btn btn-play" onclick="initGame()">–ò–ì–†–ê–¢–¨</button>
    </div>
</div>

<script>
    let settings = { size: 3, win: 3, diff: 'god', tactic: 'auto', playerSide: 'X', start: 'p' };
    let session = { board: [], active: false, turn: 'X', botSide: 'O', winLines: [], history: [], currentTactic: 'center' };
    let botTimer;

    function config(key, val, el) {
        settings[key] = val;
        [...el.parentElement.children].forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        if (key === 'size') drawEmpty();
    }

    function toggleMenu() { document.getElementById('menu').classList.toggle('hidden'); }

    function drawEmpty() {
        const b = document.getElementById('board'); b.innerHTML = '';
        b.style.setProperty('--cols', settings.size);
        let fs = settings.size > 5 ? 1.5 : 3.5;
        b.style.setProperty('--fs', fs + 'rem');
        for(let i=0; i<settings.size*settings.size; i++) {
            const c = document.createElement('div'); c.className = 'cell';
            c.innerHTML = '<span></span>'; b.appendChild(c);
        }
    }

    function initGame() {
        clearTimeout(botTimer);
        session.active = true; session.history = [];
        session.board = Array(settings.size * settings.size).fill(null);
        session.botSide = settings.playerSide === 'X' ? 'O' : 'X';
        session.turn = settings.start === 'p' ? settings.playerSide : session.botSide;
        session.winLines = generateLines(settings.size, settings.win);
        
        // –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –ë–û–ì–ê
        const t = ['center', 'corners', 'side'];
        session.currentTactic = settings.tactic === 'auto' ? t[Math.floor(Math.random()*3)] : settings.tactic;
        
        document.getElementById('menu').classList.add('hidden');
        render(); checkTurn();
    }

    function undoMove() {
        clearTimeout(botTimer);
        if (session.history.length === 0) return;
        const lastIdx = session.history[session.history.length - 1];
        let count = (session.board[lastIdx] === session.botSide) ? 2 : 1;
        for(let i = 0; i < count; i++) {
            if (session.history.length > 0) session.board[session.history.pop()] = null;
        }
        session.active = true;
        session.turn = (session.board.filter(s => s).length % 2 === 0) ? 'X' : 'O';
        render(); checkTurn();
    }

    function checkTurn() {
        if (!session.active) return;
        if (session.turn === session.botSide) {
            setStatus(`–ë–û–¢ [${session.currentTactic}]...`);
            document.getElementById('board').classList.add('locked');
            botTimer = setTimeout(botMove, 600);
        } else {
            setStatus(`–¢–í–û–ô –•–û–î (${session.turn})`);
            document.getElementById('board').classList.remove('locked');
        }
    }

    function render() {
        const b = document.getElementById('board'); b.innerHTML = '';
        session.board.forEach((val, i) => {
            const c = document.createElement('div');
            c.className = 'cell' + (val ? ' ' + val.toLowerCase() : '');
            c.innerHTML = `<span>${val || ''}</span>`;
            c.onclick = () => { if(session.active && !session.board[i]) doMove(i, session.turn); };
            b.appendChild(c);
        });
    }

    function doMove(i, sym) {
        session.board[i] = sym; session.history.push(i);
        render();
        const win = checkWin(session.board, sym);
        if (win) {
            session.active = false;
            win.forEach(idx => document.getElementById('board').children[idx].classList.add('winner'));
            setStatus(sym === settings.playerSide ? "–ü–û–ë–ï–î–ê!" : "–ë–û–¢ –í–´–ò–ì–†–ê–õ");
            return;
        }
        if (!session.board.includes(null)) { session.active = false; setStatus("–ù–ò–ß–¨–Ø"); return; }
        session.turn = (session.turn === 'X') ? 'O' : 'X';
        checkTurn();
    }

    function botMove() {
        if (!session.active) return;
        let idx = (settings.diff === 'god') ? findGodMove() : findWinMove(session.turn) || findWinMove(settings.playerSide) || randomEmpty();
        if (settings.diff === 'easy' && Math.random() < 0.6) idx = randomEmpty();
        doMove(idx, session.turn);
    }

    function findWinMove(sym) {
        for(let i=0; i<session.board.length; i++) {
            if(!session.board[i]) {
                let b = [...session.board]; b[i] = sym;
                if(checkWin(b, sym)) return i;
            }
        }
        return null;
    }

    function findGodMove() {
        let win = findWinMove(session.turn); if (win !== null) return win;
        let block = findWinMove(settings.playerSide); if (block !== null) return block;

        let weights = Array(session.board.length).fill(0);
        let center = Math.floor(settings.size / 2);

        for (let i = 0; i < session.board.length; i++) {
            if (session.board[i]) continue;
            let score = 1;
            let r = Math.floor(i / settings.size), c = i % settings.size;

            if (session.currentTactic === 'center') {
                score += (settings.size - (Math.abs(r-center) + Math.abs(c-center))) * 5;
            } else if (session.currentTactic === 'corners') {
                if ([0, settings.size-1, settings.size*(settings.size-1), settings.size*settings.size-1].includes(i)) score += 10;
            } else if (session.currentTactic === 'side') {
                if ((r===0 || r===settings.size-1 || c===0 || c===settings.size-1) && 
                    ![0, settings.size-1, settings.size*(settings.size-1), settings.size*settings.size-1].includes(i)) score += 10;
            }
            weights[i] = score + (Math.random() * 2);
        }
        let maxW = -1, best = [];
        weights.forEach((w, i) => {
            if (session.board[i]) return;
            if (w > maxW) { maxW = w; best = [i]; }
            else if (Math.abs(w-maxW) < 0.1) best.push(i);
        });
        return best[Math.floor(Math.random() * best.length)];
    }

    function randomEmpty() {
        const empty = session.board.map((v, i) => v === null ? i : null).filter(v => v !== null);
        return empty[Math.floor(Math.random() * empty.length)];
    }

    function getHint() {
        if (!session.active) return;
        const idx = findGodMove();
        const cell = document.getElementById('board').children[idx];
        cell.classList.add('hint'); setTimeout(() => cell.classList.remove('hint'), 600);
    }

    function generateLines(s, w) {
        let lines = [];
        for (let r = 0; r < s; r++) { for (let c = 0; c <= s - w; c++) { let l = []; for (let k = 0; k < w; k++) l.push(r * s + (c + k)); lines.push(l); } }
        for (let c = 0; c < s; c++) { for (let r = 0; r <= s - w; r++) { let l = []; for (let k = 0; k < w; k++) l.push((r + k) * s + c); lines.push(l); } }
        for (let r = 0; r <= s - w; r++) { for (let c = 0; c <= s - w; c++) { 
            let l1 = [], l2 = []; for (let k = 0; k < w; k++) { l1.push((r + k) * s + (c + k)); l2.push((r + k) * s + (c + w - 1 - k)); } 
            lines.push(l1); lines.push(l2); 
        } }
        return lines;
    }

    function checkWin(b, sym) { for (let line of session.winLines) { if (line.every(i => b[i] === sym)) return line; } return null; }
    function setStatus(t) { document.getElementById('status').innerText = t; }
    function customSettings() { 
        let n = prompt("–ü–æ–ª–µ:", settings.size); if(n) { settings.size = parseInt(n); settings.win = Math.min(settings.size, 5); drawEmpty(); }
    }
    drawEmpty();
</script>
</body>
</html>
