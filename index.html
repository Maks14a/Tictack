<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON TACTICS: ULTIMATE EDITION</title>
    <style>
        :root {
            --bg: #020617;
            --panel: rgba(30, 41, 59, 0.95);
            --primary: #38bdf8;
            --accent-x: #fb7185;
            --accent-o: #34d399;
            --text: #f1f5f9;
        }

        * { 
            box-sizing: border-box; margin: 0; padding: 0; 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            overflow-x: hidden;
        }

        .wrapper {
            width: 100%;
            max-width: 420px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .header-box {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            position: relative;
        }

        h1 {
            text-align: center;
            color: var(--primary);
            letter-spacing: 4px;
            font-size: 1.8rem;
            text-shadow: 0 0 15px rgba(56, 189, 248, 0.4);
            font-weight: 900;
        }

        .edit-tool {
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.6;
            transition: 0.3s;
        }
        .edit-tool:hover { opacity: 1; transform: scale(1.1); }

        .status-bar {
            background: rgba(255,255,255,0.05);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 800;
            color: var(--primary);
            text-transform: uppercase;
            border: 1px solid rgba(255,255,255,0.1);
            min-height: 45px;
        }

        .settings-container {
            background: var(--panel);
            border-radius: 20px;
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .settings-container.hidden { display: none; }
        .row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
        .row-label { font-size: 0.7rem; color: #94a3b8; font-weight: 900; text-transform: uppercase; width: 75px; }
        .group { display: flex; flex: 1; background: rgba(0,0,0,0.3); padding: 4px; border-radius: 10px; }
        .opt-btn {
            flex: 1; padding: 10px 0; border: none; background: transparent;
            color: #64748b; font-weight: bold; cursor: pointer; border-radius: 7px;
            font-size: 0.8rem; transition: 0.2s;
        }
        .opt-btn.active { background: var(--primary); color: #020617; }
        .opt-btn:disabled { opacity: 0.1; cursor: not-allowed; }

        .board-frame {
            width: 100%;
            aspect-ratio: 1 / 1;
            display: flex; align-items: center; justify-content: center;
        }

        .board-grid {
            display: grid;
            width: 100%;
            height: 100%;
            gap: 6px;
            grid-template-columns: repeat(var(--cols, 3), 1fr);
            grid-template-rows: repeat(var(--cols, 3), 1fr);
        }

        .cell {
            background: #0f172a;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; aspect-ratio: 1 / 1;
            border: 1px solid rgba(255,255,255,0.05);
            transition: 0.15s;
        }

        .cell:active { transform: scale(0.92); }
        .cell span { font-size: var(--fs, 3rem); font-weight: 900; }
        .cell.x span { color: var(--accent-x); text-shadow: 0 0 15px var(--accent-x); }
        .cell.o span { color: var(--accent-o); text-shadow: 0 0 15px var(--accent-o); }
        .cell.winner { background: var(--primary); box-shadow: 0 0 20px var(--primary); }
        .cell.winner span { color: #020617; text-shadow: none; }
        .cell.hint { background: rgba(251, 191, 36, 0.2); border: 2px solid #fbbf24; }

        .footer-btns { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .btn {
            padding: 15px 5px; border: none; border-radius: 14px;
            font-weight: 900; cursor: pointer; text-transform: uppercase;
            font-size: 0.7rem; transition: 0.2s;
        }
        .btn-play { background: var(--primary); color: #020617; }
        .btn-side { background: #334155; color: white; }
        .btn-hint { background: #475569; color: #fbbf24; }
        .btn-undo { background: #1e293b; color: #94a3b8; border: 1px solid rgba(255,255,255,0.1); }
        .locked { pointer-events: none; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="header-box">
        <h1>NEON TACTICS</h1>
        <div class="edit-tool" onclick="customSettings()">‚úèÔ∏è</div>
    </div>

    <div class="status-bar" id="status">–ì–û–¢–û–í –ö –¢–†–£–î–£</div>

    <div class="settings-container" id="menu">
        <div class="row">
            <span class="row-label">–ü–û–õ–ï</span>
            <div class="group" id="set-size">
                <button class="opt-btn active" onclick="config('size', 3, this)">3x3</button>
                <button class="opt-btn" onclick="config('size', 4, this)">4x4</button>
                <button class="opt-btn" onclick="config('size', 5, this)">5x5</button>
            </div>
        </div>
        <div class="row">
            <span class="row-label">–£–°–õ–û–í–ò–ï</span>
            <div class="group" id="set-win">
                <button class="opt-btn active" data-v="3" onclick="config('win', 3, this)">3</button>
                <button class="opt-btn" data-v="4" onclick="config('win', 4, this)">4</button>
                <button class="opt-btn" data-v="5" onclick="config('win', 5, this)">5</button>
            </div>
        </div>
        <div class="row">
            <span class="row-label">–ú–û–ó–ì–ò</span>
            <div class="group" id="set-diff">
                <button class="opt-btn" onclick="config('diff', 'easy', this)">–ò–ó–ò</button>
                <button class="opt-btn" onclick="config('diff', 'norm', this)">–ù–û–†–ú</button>
                <button class="opt-btn active" onclick="config('diff', 'god', this)">–ë–û–ì</button>
            </div>
        </div>
        <div class="row">
            <span class="row-label">–†–ï–ñ–ò–ú</span>
            <div class="group" id="set-pro">
                <button class="opt-btn active" onclick="config('pro', false, this)">–í–´–ö–õ</button>
                <button class="opt-btn" onclick="config('pro', true, this)">PRO</button>
            </div>
        </div>
        <div class="row">
            <span class="row-label">–Ø –ò–ì–†–ê–Æ –ó–ê</span>
            <div class="group" id="set-side">
                <button class="opt-btn active" onclick="config('playerSide', 'X', this)">X</button>
                <button class="opt-btn" onclick="config('playerSide', 'O', this)">O</button>
            </div>
        </div>
        <div class="row">
            <span class="row-label">–•–û–î–ò–¢</span>
            <div class="group" id="set-start">
                <button class="opt-btn active" onclick="config('start', 'p', this)">–Ø</button>
                <button class="opt-btn" onclick="config('start', 'b', this)">–ë–û–¢</button>
            </div>
        </div>
    </div>

    <div class="board-frame">
        <div class="board-grid" id="board"></div>
    </div>

    <div class="footer-btns">
        <button class="btn btn-side" onclick="toggleMenu()">‚öôÔ∏è</button>
        <button class="btn btn-hint" onclick="getHint()">üí°</button>
        <button class="btn btn-undo" onclick="undoMove()">‚Ü©Ô∏è</button>
        <button class="btn btn-play" onclick="initGame()">–ò–ì–†–ê–¢–¨</button>
    </div>
</div>
<script>
    let settings = { size: 3, win: 3, diff: 'god', pro: false, playerSide: 'X', start: 'p' };
    let session = { board: [], active: false, turn: 'X', botSide: 'O', winLines: [], history: [] };
    let botTimer;

    function customSettings() {
        let n = prompt("–†–∞–∑–º–µ—Ä –ø–æ–ª—è (N):", settings.size); if(!n) return;
        let w = prompt("–£—Å–ª–æ–≤–∏–µ –ø–æ–±–µ–¥—ã:", settings.win); if(!w) return;
        settings.size = parseInt(n); settings.win = parseInt(w);
        drawEmpty(); setStatus(`–†–ï–ñ–ò–ú: ${n}x${n} (${w} –≤ —Ä—è–¥)`);
    }

    function config(key, val, el) {
        settings[key] = val;
        [...el.parentElement.children].forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        if (key === 'size') {
            const winBtns = document.getElementById('set-win').children;
            [...winBtns].forEach(b => { b.disabled = parseInt(b.dataset.v) > settings.size; });
            drawEmpty();
        }
    }

    function toggleMenu() { document.getElementById('menu').classList.toggle('hidden'); }

    function drawEmpty() {
        const b = document.getElementById('board'); b.innerHTML = '';
        b.style.setProperty('--cols', settings.size);
        let fontSize = settings.size > 8 ? 1 : settings.size > 5 ? 1.5 : settings.size > 3 ? 2.5 : 3.5;
        b.style.setProperty('--fs', fontSize + 'rem');
        for(let i=0; i<settings.size*settings.size; i++) {
            const c = document.createElement('div'); c.className = 'cell';
            c.innerHTML = '<span></span>'; b.appendChild(c);
        }
    }

    function initGame() {
        clearTimeout(botTimer);
        session.active = true;
        session.history = [];
        session.board = Array(settings.size * settings.size).fill(null);
        session.botSide = settings.playerSide === 'X' ? 'O' : 'X';
        
        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –û—á–µ—Ä–µ–¥—å —Ö–æ–¥–∞ —Ç–µ–ø–µ—Ä—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±–æ—Ä–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (–Ø –∏–ª–∏ –ë–û–¢)
        session.turn = settings.start === 'p' ? settings.playerSide : session.botSide;
        
        session.winLines = generateLines(settings.size, settings.win);
        document.getElementById('menu').classList.add('hidden');
        render();
        checkTurn();
    }

    function render() {
        const b = document.getElementById('board');
        b.innerHTML = '';
        session.board.forEach((val, i) => {
            const c = document.createElement('div');
            c.className = 'cell' + (val ? ' ' + val.toLowerCase() : '');
            c.innerHTML = `<span>${val || ''}</span>`;
            c.onclick = () => { if(session.active && !session.board[i] && session.turn === settings.playerSide) doMove(i, session.turn); };
            b.appendChild(c);
        });
    }

    function doMove(i, sym) {
        session.board[i] = sym;
        session.history.push(i);
        render();
        const win = checkWin(session.board, sym);
        if (win) {
            session.active = false;
            win.forEach(idx => document.getElementById('board').children[idx].classList.add('winner'));
            setStatus(sym === settings.playerSide ? "–ü–û–ë–ï–î–ê!" : "–ë–û–¢ –í–´–ò–ì–†–ê–õ");
            return;
        }
        if (!session.board.includes(null)) { session.active = false; setStatus("–ù–ò–ß–¨–Ø"); return; }
        session.turn = (session.turn === 'X') ? 'O' : 'X';
        checkTurn();
    }

    function checkTurn() {
        if (!session.active) return;
        if (session.turn === session.botSide) {
            setStatus("–ë–û–¢ –î–£–ú–ê–ï–¢...");
            document.getElementById('board').classList.add('locked');
            botTimer = setTimeout(botMove, 600);
        } else {
            setStatus("–¢–í–û–ô –•–û–î (" + session.turn + ")");
            document.getElementById('board').classList.remove('locked');
        }
    }

    function botMove() {
        if (!session.active) return;
        let idx;
        if (settings.diff === 'god') {
            // –ë–µ–∑ PRO - —á–∏—Å—Ç—ã–π –º–æ—â–Ω—ã–π –ø—Ä–æ—Å—á–µ—Ç
            let depth = settings.size === 3 ? 10 : 6;
            idx = minimax(session.board, 0, true, -Infinity, Infinity, depth).index;
        } else if (settings.diff === 'norm') {
            idx = minimax(session.board, 0, true, -Infinity, Infinity, 2).index;
        } else {
            idx = randomEmpty();
        }
        if (idx !== null) doMove(idx, session.turn);
    }

    function evaluate(board) {
        let score = 0;
        for (let line of session.winLines) {
            let b = 0, p = 0;
            for (let idx of line) {
                if (board[idx] === session.botSide) b++;
                else if (board[idx] === settings.playerSide) p++;
            }
            if (b > 0 && p > 0) continue;
            if (b > 0) score += Math.pow(10, b);
            if (p > 0) score -= Math.pow(10, p + 0.5);
        }
        return score;
    }

    function getMoves(board) {
        let moves = [];
        for (let i = 0; i < board.length; i++) {
            if (!board[i]) {
                let near = false;
                for (let j = 0; j < board.length; j++) {
                    if (board[j]) {
                        let r1 = Math.floor(i/settings.size), c1 = i%settings.size;
                        let r2 = Math.floor(j/settings.size), c2 = j%settings.size;
                        if (Math.abs(r1-r2) <= 1 && Math.abs(c1-c2) <= 1) { near = true; break; }
                    }
                }
                if (near || board.filter(x => x).length === 0) moves.push(i);
            }
        }
        return moves.length ? moves : [Math.floor(board.length/2)];
    }

    function minimax(board, depth, isMax, alpha, beta, maxD) {
        if (checkWin(board, session.botSide)) return { score: 1000000 - depth };
        if (checkWin(board, settings.playerSide)) return { score: -1000000 + depth };
        if (!board.includes(null) || depth >= maxD) return { score: evaluate(board) };

        let moves = getMoves(board);
        let best = { score: isMax ? -Infinity : Infinity, index: moves[0] };

        for (let i of moves) {
            board[i] = isMax ? session.botSide : settings.playerSide;
            let res = minimax(board, depth + 1, !isMax, alpha, beta, maxD);
            board[i] = null;

            if (isMax) {
                if (res.score > best.score) { best.score = res.score; best.index = i; }
                alpha = Math.max(alpha, best.score);
            } else {
                if (res.score < best.score) { best.score = res.score; best.index = i; }
                beta = Math.min(beta, best.score);
            }
            if (beta <= alpha) break;
        }
        return best;
    }

    function checkWin(b, sym) {
        for (let line of session.winLines) {
            if (line.every(i => b[i] === sym)) return line;
        }
        return null;
    }

    function generateLines(s, w) {
        let lines = [];
        for (let r = 0; r < s; r++) { 
            for (let c = 0; c <= s - w; c++) { 
                let l = []; for (let k = 0; k < w; k++) l.push(r * s + (c + k)); lines.push(l); 
            } 
        }
        for (let c = 0; c < s; c++) { 
            for (let r = 0; r <= s - w; r++) { 
                let l = []; for (let k = 0; k < w; k++) l.push((r + k) * s + c); lines.push(l); 
            } 
        }
        for (let r = 0; r <= s - w; r++) { 
            for (let c = 0; c <= s - w; c++) { 
                let l1 = [], l2 = []; 
                for (let k = 0; k < w; k++) { 
                    l1.push((r + k) * s + (c + k)); 
                    l2.push((r + k) * s + (c + w - 1 - k)); 
                } 
                lines.push(l1); lines.push(l2); 
            } 
        }
        return lines;
    }

    function randomEmpty() {
        const empty = session.board.map((v, i) => v === null ? i : null).filter(v => v !== null);
        return empty.length ? empty[Math.floor(Math.random() * empty.length)] : null;
    }

    function undoMove() {
        clearTimeout(botTimer);
        for(let i=0; i<2; i++) {
            if (session.history.length > 0) {
                let idx = session.history.pop();
                session.board[idx] = null;
            }
        }
        session.active = true;
        session.turn = settings.playerSide;
        render();
        setStatus("–û–¢–ö–ê–¢ –•–û–î–ê");
        document.getElementById('board').classList.remove('locked');
    }

    function getHint() {
        if (!session.active) return;
        const move = minimax(session.board, 0, true, -Infinity, Infinity, 5);
        const cell = document.getElementById('board').children[move.index];
        cell.classList.add('hint'); setTimeout(() => cell.classList.remove('hint'), 800);
    }

    function setStatus(t) { document.getElementById('status').innerText = t; }
    drawEmpty();
</script>
    
</body>
</html>
